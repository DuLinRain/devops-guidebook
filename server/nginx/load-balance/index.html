<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/devops-guidebook//linux">Linux</a><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a><a href="/devops-guidebook//data-base">数据库</a><a href="/devops-guidebook//deploy">部署</a><a href="/devops-guidebook//version">版本管理</a><a href="/devops-guidebook//devops">DevOps</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//data-base">数据库</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//version">版本管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx">Nginx</a><ul><li><a href="/devops-guidebook//server/nginx/overview"><span>基本概要</span></a></li><li><a href="/devops-guidebook//server/nginx/getting-start"><span>快速开始</span></a></li><li><a href="/devops-guidebook//server/nginx/configuration"><span>配置文件</span></a></li><li><a href="/devops-guidebook//server/nginx/proxy-service"><span>代理服务</span></a></li><li><a href="/devops-guidebook//server/nginx/static-resource-server"><span>静态资源服务器</span></a></li><li><a href="/devops-guidebook//server/nginx/dynamic-cache"><span>动态缓存</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx/load-balance"><span>负载均衡</span></a></li><li><a href="/devops-guidebook//server/nginx/command"><span>命令行操作</span></a></li><li><a href="/devops-guidebook//server/nginx/bug-logs"><span>踩坑日志</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="GSLB" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/load-balance#gslb"><span>GSLB</span></a></li><li title="SLB" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/load-balance#slb"><span>SLB</span></a></li><li title="四层负载均衡" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/load-balance#四层负载均衡"><span>四层负载均衡</span></a></li><li title="七层负载均衡" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/load-balance#七层负载均衡"><span>七层负载均衡</span></a></li><li title="调度算法" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/load-balance#调度算法"><span>调度算法</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="负载均衡"><a aria-hidden="true" href="#负载均衡"><span class="icon icon-link"></span></a>负载均衡</h1><h2 id="gslb"><a aria-hidden="true" href="#gslb"><span class="icon icon-link"></span></a>GSLB</h2><blockquote><p>GSLB 是英文 Global Server Load Balance 的缩写，意思是全局负载均衡。作用：实现在广域网（包括互联网）上不同地域的服务器间的流量调配，保证使用最佳的服务器服务离自己最近的客户，从而确保访问质量。</p></blockquote><h2 id="slb"><a aria-hidden="true" href="#slb"><span class="icon icon-link"></span></a>SLB</h2><blockquote><p>负载均衡（Server Load Balancer，简称 SLB）是一种网络负载均衡服务，针对阿里云弹性计算平台而设计，在系统架构、系统安全及性能，扩展，兼容性设计上都充分考虑了弹性计算平台云服务器使用特点和特定的业务场景。</p></blockquote><h2 id="四层负载均衡"><a aria-hidden="true" href="#四层负载均衡"><span class="icon icon-link"></span></a>四层负载均衡</h2><h2 id="七层负载均衡"><a aria-hidden="true" href="#七层负载均衡"><span class="icon icon-link"></span></a>七层负载均衡</h2><p>配置语法：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: upstream name{...}
default: -
context: http
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: upstream name</span><span class="token punctuation">{</span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: -</span></div><div class="token-line"><span class="token plain">context: http</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>🌰 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="upstream imooc {
    server 116.62.103.228:8001;
    server 116.62.103.228:8002;
    server 116.62.103.228:8003;
}

server {
    listen 80;
    server_name localhost jeson.t.imooc.io;

    #charset koi8-r
    access_log /var/log/nginx/test_proxy.access.log main;

    location / {
        proxy_pass http://imooc;
        include proxy_params;
    }

    # error_page 404 /404.html
}
" data-status="copy"></button><div class="token-line"><span class="token plain">upstream imooc {</span></div><div class="token-line"><span class="token plain">    server 116.62.103.228:8001;</span></div><div class="token-line"><span class="token plain">    server 116.62.103.228:8002;</span></div><div class="token-line"><span class="token plain">    server 116.62.103.228:8003;</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">server {</span></div><div class="token-line"><span class="token plain">    listen 80;</span></div><div class="token-line"><span class="token plain">    server_name localhost jeson.t.imooc.io;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    #charset koi8-r</span></div><div class="token-line"><span class="token plain">    access_log /var/log/nginx/test_proxy.access.log main;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    location / {</span></div><div class="token-line"><span class="token plain">        proxy_pass http://imooc;</span></div><div class="token-line"><span class="token plain">        include proxy_params;</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    # error_page 404 /404.html</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>后端服务器在负载均衡调度中的状态</strong></p><table><thead><tr><th>字段</th><th>作用</th></tr></thead><tbody><tr><td>down</td><td>当前的 Server 暂时不参与负载均衡</td></tr><tr><td>backup</td><td>预留的备份服务器</td></tr><tr><td>max_fails</td><td>允许请求失败的次数</td></tr><tr><td>fail_timeout</td><td>经过 max_fails 失败后，服务暂停的时间</td></tr><tr><td>max_conns</td><td>限制最大的接收的连接数</td></tr></tbody></table><h2 id="调度算法"><a aria-hidden="true" href="#调度算法"><span class="icon icon-link"></span></a>调度算法</h2><table><thead><tr><th>字段</th><th>作用</th></tr></thead><tbody><tr><td>轮询</td><td>按时间顺序逐一分配到不同的后端服务器</td></tr><tr><td>加权轮询</td><td>weight 值越大，分配到的访问几率越高</td></tr><tr><td>ip_hash</td><td>每个请求按访问 ip 的 hash 结果分配，这样来自同个 ip 的固定访问一个后端服务器</td></tr><tr><td>least_conn</td><td>最少链接数，那个机器连接数少就分支</td></tr><tr><td>url_hash</td><td>按照访问的 url 的 hash 结果来分配请求，是每个 url 定向到同一个后端服务器</td></tr><tr><td>hash 关键值</td><td>hash 自定义的 key</td></tr></tbody></table><p><a href="https://juejin.im/post/5e806d84e51d4546b659b370" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5e806d84e51d4546b659b370<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/server/nginx/load-balance.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">7/18/2020, 3:49:50 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__server__nginx__load-balance.md.js"></script>
  </body>
</html>
