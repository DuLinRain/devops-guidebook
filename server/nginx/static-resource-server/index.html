<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x9759;&#x6001;&#x8D44;&#x6E90;&#x670D;&#x52A1;&#x5668;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/devops-guidebook//linux">Linux</a><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a><a href="/devops-guidebook//data-base">数据库</a><a href="/devops-guidebook//deploy">部署</a><a href="/devops-guidebook//version">版本管理</a><a href="/devops-guidebook//devops">DevOps</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//data-base">数据库</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//version">版本管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx">Nginx</a><ul><li><a href="/devops-guidebook//server/nginx/overview"><span>基本概要</span></a></li><li><a href="/devops-guidebook//server/nginx/getting-start"><span>快速开始</span></a></li><li><a href="/devops-guidebook//server/nginx/configuration"><span>配置文件</span></a></li><li><a href="/devops-guidebook//server/nginx/proxy-service"><span>代理服务</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx/static-resource-server"><span>静态资源服务器</span></a></li><li><a href="/devops-guidebook//server/nginx/dynamic-cache"><span>动态缓存</span></a></li><li><a href="/devops-guidebook//server/nginx/load-balance"><span>负载均衡</span></a></li><li><a href="/devops-guidebook//server/nginx/command"><span>命令行操作</span></a></li><li><a href="/devops-guidebook//server/nginx/bug-logs"><span>踩坑日志</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="静态资源" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/static-resource-server#静态资源"><span>静态资源</span></a></li><li title="文件读取配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/static-resource-server#文件读取配置"><span>文件读取配置</span></a></li><li title="浏览器缓存" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/static-resource-server#浏览器缓存"><span>浏览器缓存</span></a></li><li title="跨域访问" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/static-resource-server#跨域访问"><span>跨域访问</span></a></li><li title="防盗链" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/static-resource-server#防盗链"><span>防盗链</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="静态资源服务器"><a aria-hidden="true" href="#静态资源服务器"><span class="icon icon-link"></span></a>静态资源服务器</h1><h2 id="静态资源"><a aria-hidden="true" href="#静态资源"><span class="icon icon-link"></span></a>静态资源</h2><ul><li>浏览器端渲染：HTML、CSS、JS</li><li>图片：JPEG、GIF、PNG</li><li>视频：FLV、MPEG</li><li>文件：TXT 等任意下载文件</li></ul><h2 id="文件读取配置"><a aria-hidden="true" href="#文件读取配置"><span class="icon icon-link"></span></a>文件读取配置</h2><p>📖 <strong>语法</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: sendfile on | off
deafult: sendfile off
context: http,server,location,if in location
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: sendfile on </span><span class="token operator">|</span><span class="token plain"> off</span></div><div class="token-line"><span class="token plain">deafult: sendfile off</span></div><div class="token-line"><span class="token plain">context: http,server,location,if </span><span class="token keyword">in</span><span class="token plain"> location</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>--with-file-aio</code> 异步文件读取。</p><p>📖 <strong>语法</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: tcp_nopush on | off
default: tcp_nopush off
context: http, server, location
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: tcp_nopush on </span><span class="token operator">|</span><span class="token plain"> off</span></div><div class="token-line"><span class="token plain">default: tcp_nopush off</span></div><div class="token-line"><span class="token plain">context: http, server, location</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>sendfile 开启的情况下，提高网络包的传输效率（等待，一次传输）</p><h2 id="浏览器缓存"><a aria-hidden="true" href="#浏览器缓存"><span class="icon icon-link"></span></a>浏览器缓存</h2><p>添加 <code>cache-control</code> 和 <code>expires</code> 头。</p><p>📖 <strong>语法</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: expires [modified] time;
                expires epoch | max | off;
default: expires off;
context: http, server, location
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: expires </span><span class="token punctuation">[</span><span class="token plain">modified</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token function">time</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                expires epoch </span><span class="token operator">|</span><span class="token plain"> max </span><span class="token operator">|</span><span class="token plain"> off</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: expires off</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">context: http, server, location</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>🌰 <strong>配置示例</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="location ~ .*\.(htm|html)$ {
    #expires 24h;
    root /opt/app/code;
}
" data-status="copy"></button><div class="token-line"><span class="token plain">location ~ .*\.(htm|html)$ {</span></div><div class="token-line"><span class="token plain">    #expires 24h;</span></div><div class="token-line"><span class="token plain">    root /opt/app/code;</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="跨域访问"><a aria-hidden="true" href="#跨域访问"><span class="icon icon-link"></span></a>跨域访问</h2><p>📖 <strong>语法</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: add_header bane value [always]
default: -
context: http, server, location, if in location
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: add_header bane value </span><span class="token punctuation">[</span><span class="token plain">always</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: -</span></div><div class="token-line"><span class="token plain">context: http, server, location, </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token keyword">in</span><span class="token plain"> location</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>添加请求头：Access-Control-Allow-Origin</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="location ~ .*\.(htm|html)$ {
    #add_header Access-Control-Allow-Origin http://www.jesonc.com;
    #add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;
    root /opt/app/code;
}
" data-status="copy"></button><div class="token-line"><span class="token plain">location ~ .*\.(htm|html)$ {</span></div><div class="token-line"><span class="token plain">    #add_header Access-Control-Allow-Origin http://www.jesonc.com;</span></div><div class="token-line"><span class="token plain">    #add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;</span></div><div class="token-line"><span class="token plain">    root /opt/app/code;</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="防盗链"><a aria-hidden="true" href="#防盗链"><span class="icon icon-link"></span></a>防盗链</h2><p>防盗链机制的目的是防止服务器上的资源（例如图片、文件等）被其它用户采用其它的技术手段来访问或下载。</p><p>实现方式：区别哪些请求是非正常的用户请求</p><p>基于 <code>http_refer</code> 防盗链配置模块：</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="location ~* \.(gif|jpg|png|jpeg)$ {
    # 只允许 192.168.0.1 请求资源
    valid_referers none blocked 192.168.0.1;
    if ($invalid_referer) {
        rewrite ^/ http://$host/logo.png;
    }
}
" data-status="copy"></button><div class="token-line"><span class="token plain">location ~* \.(gif|jpg|png|jpeg)$ {</span></div><div class="token-line"><span class="token plain">    # 只允许 192.168.0.1 请求资源</span></div><div class="token-line"><span class="token plain">    valid_referers none blocked 192.168.0.1;</span></div><div class="token-line"><span class="token plain">    if ($invalid_referer) {</span></div><div class="token-line"><span class="token plain">        rewrite ^/ http://$host/logo.png;</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>设置防盗链文件类型，自行修改，每个后缀用 <code>|</code> 符号分隔</li><li>允许文件链出的域名白名单，自行修改成己方域名，域名与域名之间使用空格隔开</li></ul><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/post/5a2600bdf265da432b4aaaba#heading-76" target="_blank" rel="noopener noreferrer">Nginx 从入门到实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://juejin.im/entry/5d7e4540f265da03b76b50cc" target="_blank" rel="noopener noreferrer">后端必备 Nginx 配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/server/nginx/static-resource-server.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">7/11/2020, 7:44:42 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__server__nginx__static-resource-server.md.js"></script>
  </body>
</html>
