<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x4EE3;&#x7406;&#x670D;&#x52A1;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/devops-guidebook//linux">Linux</a><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a><a href="/devops-guidebook//data-base">数据库</a><a href="/devops-guidebook//deploy">部署</a><a href="/devops-guidebook//version">版本管理</a><a href="/devops-guidebook//devops">DevOps</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/favicon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//data-base">数据库</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//version">版本管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx">Nginx</a><ul><li><a href="/devops-guidebook//server/nginx/overview"><span>基本概要</span></a></li><li><a href="/devops-guidebook//server/nginx/getting-start"><span>快速开始</span></a></li><li><a href="/devops-guidebook//server/nginx/configuration"><span>配置文件</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//server/nginx/proxy-service"><span>代理服务</span></a></li><li><a href="/devops-guidebook//server/nginx/static-resource-server"><span>静态资源服务器</span></a></li><li><a href="/devops-guidebook//server/nginx/dynamic-cache"><span>动态缓存</span></a></li><li><a href="/devops-guidebook//server/nginx/load-balance"><span>负载均衡</span></a></li><li><a href="/devops-guidebook//server/nginx/command"><span>命令行操作</span></a></li><li><a href="/devops-guidebook//server/nginx/bug-logs"><span>踩坑日志</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="代理区别" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#代理区别"><span>代理区别</span></a></li><li title="代理配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#代理配置"><span>代理配置</span></a></li><li title="缓存区配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#缓存区配置"><span>缓存区配置</span></a></li><li title="跳转重定向配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#跳转重定向配置"><span>跳转重定向配置</span></a></li><li title="头信息配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#头信息配置"><span>头信息配置</span></a></li><li title="超时配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#超时配置"><span>超时配置</span></a></li><li title="总配置" data-depth="2" class=""><a href="/devops-guidebook//server/nginx/proxy-service#总配置"><span>总配置</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="代理服务"><a aria-hidden="true" href="#代理服务"><span class="icon icon-link"></span></a>代理服务</h1><h2 id="代理区别"><a aria-hidden="true" href="#代理区别"><span class="icon icon-link"></span></a>代理区别</h2><ul><li>正向代理的对象是客户端</li><li>反向代理代理的是服务器</li></ul><h2 id="代理配置"><a aria-hidden="true" href="#代理配置"><span class="icon icon-link"></span></a>代理配置</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: proxy_pass URL;
default: -
context: location, if in location, limit_except
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: proxy_pass URL</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: -</span></div><div class="token-line"><span class="token plain">context: location, </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token keyword">in</span><span class="token plain"> location, limit_except</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>URL 一般为：</p><ul><li><code>http://localhost:8000/uri</code></li><li><code>https://192.168.1.1:8000/uri</code></li><li><code>http://unix:/tmp/backend.socket:/uri/</code></li></ul><p><strong>反向代理配置</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="listen 80;
server_name localhost jeson.t.imooc.io;

#charset koi8-r
access_log /var/log/nginx/test_proxy.access.log main;

location / {
  root  /usr/share/nginx/html;
  index index.html index.htm;
}

location ~ /test_proxy.html$ {
    proxy_pass http://127.0.0.1:8080
}
" data-status="copy"></button><div class="token-line"><span class="token plain">listen 80;</span></div><div class="token-line"><span class="token plain">server_name localhost jeson.t.imooc.io;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">#charset koi8-r</span></div><div class="token-line"><span class="token plain">access_log /var/log/nginx/test_proxy.access.log main;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">location / {</span></div><div class="token-line"><span class="token plain">  root  /usr/share/nginx/html;</span></div><div class="token-line"><span class="token plain">  index index.html index.htm;</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">location ~ /test_proxy.html$ {</span></div><div class="token-line"><span class="token plain">    proxy_pass http://127.0.0.1:8080</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>想访问 8080，只能访问到 80，通过 80 然后通过反向代理可以访问到 8080。</p><h2 id="缓存区配置"><a aria-hidden="true" href="#缓存区配置"><span class="icon icon-link"></span></a>缓存区配置</h2><p>📖 <strong>语法</strong>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: proxy_buffering on | off
default: proxy_buffering on
context: location, http, server
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: proxy_buffering on </span><span class="token operator">|</span><span class="token plain"> off</span></div><div class="token-line"><span class="token plain">default: proxy_buffering on</span></div><div class="token-line"><span class="token plain">context: location, http, server</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>扩展：</p><ul><li><code>proxy_buffer_size</code></li><li><code>proxy_buffers</code></li><li><code>proxy_busy_buffers size</code></li></ul><h2 id="跳转重定向配置"><a aria-hidden="true" href="#跳转重定向配置"><span class="icon icon-link"></span></a>跳转重定向配置</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: proxy_redirect default;proxy_redirect off;proxy_redirect redirect replacement;
default: proxy_redirect default;
context: location,http,server
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: proxy_redirect default</span><span class="token punctuation">;</span><span class="token plain">proxy_redirect off</span><span class="token punctuation">;</span><span class="token plain">proxy_redirect redirect replacement</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: proxy_redirect default</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">context: location,http,server</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="头信息配置"><a aria-hidden="true" href="#头信息配置"><span class="icon icon-link"></span></a>头信息配置</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: proxy_set_header field value;
default: proxy_set_header host $proxy_host
         proxy_set_header connection close;
context: location,http,server
" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: proxy_set_header field value</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: proxy_set_header </span><span class="token function">host</span><span class="token plain"> </span><span class="token variable">$proxy_host</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">         proxy_set_header connection close</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">context: location,http,server</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="超时配置"><a aria-hidden="true" href="#超时配置"><span class="icon icon-link"></span></a>超时配置</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="syntax: proxy_connect_timeout time;
default: proxy_connect_timeout 60s;
context:location,http,server

" data-status="copy"></button><div class="token-line"><span class="token plain">syntax: proxy_connect_timeout </span><span class="token function">time</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">default: proxy_connect_timeout 60s</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">context:location,http,server</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>扩展：</p><ul><li><code>proxy_read_timeout</code></li><li><code>proxy_send_timeout</code></li></ul><h2 id="总配置"><a aria-hidden="true" href="#总配置"><span class="icon icon-link"></span></a>总配置</h2><div class="__dumi-default-code-block"><pre class="prism-code language-nginx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="server {
    listen 80;
    server_name localhostjeson.t.imooc.io;

    # charset koi8-r;
    access_log /var/log/nginx/test_proxy.access.log main;

    location / {
        proxy_pass http://127.0.0.1:8080
        proxy_redirect default;

        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;

        proxy_connect_timeout 30;
        proxy_send_timeout 60;
        proxy_read_timeout 60;

        proxy_buffer_size 32k;
        proxy_buffering on;
        proxy_buffers 4 128k;
        proxy_busy_buffers_size 256k;
        proxy_max_temp_file_size 256k;
    }
}
" data-status="copy"></button><div class="token-line"><span class="token plain">server {</span></div><div class="token-line"><span class="token plain">    listen 80;</span></div><div class="token-line"><span class="token plain">    server_name localhostjeson.t.imooc.io;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    # charset koi8-r;</span></div><div class="token-line"><span class="token plain">    access_log /var/log/nginx/test_proxy.access.log main;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    location / {</span></div><div class="token-line"><span class="token plain">        proxy_pass http://127.0.0.1:8080</span></div><div class="token-line"><span class="token plain">        proxy_redirect default;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        proxy_set_header Host $http_host;</span></div><div class="token-line"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        proxy_connect_timeout 30;</span></div><div class="token-line"><span class="token plain">        proxy_send_timeout 60;</span></div><div class="token-line"><span class="token plain">        proxy_read_timeout 60;</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        proxy_buffer_size 32k;</span></div><div class="token-line"><span class="token plain">        proxy_buffering on;</span></div><div class="token-line"><span class="token plain">        proxy_buffers 4 128k;</span></div><div class="token-line"><span class="token plain">        proxy_busy_buffers_size 256k;</span></div><div class="token-line"><span class="token plain">        proxy_max_temp_file_size 256k;</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/server/nginx/proxy-service.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">7/11/2020, 7:44:42 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__server__nginx__proxy-service.md.js"></script>
  </body>
</html>
