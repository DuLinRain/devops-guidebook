<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x57FA;&#x672C;&#x64CD;&#x4F5C;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/data-base/mongodb/basic-usage" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/devops-guidebook//linux">Linux</a></span><span><a href="/devops-guidebook//server">服务器</a></span><span><a aria-current="page" class="active" href="/devops-guidebook//data-base">数据库</a></span><span><a href="/devops-guidebook//deploy">部署</a></span><span><a href="/devops-guidebook//code">代码管理</a></span><span><a href="/devops-guidebook//devops">DevOps</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a href="/devops-guidebook//server">服务器</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//data-base">数据库</a></li><li><a href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//code">代码管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/devops-guidebook//data-base">数据库</a></li><li><a href="/devops-guidebook//data-base/no-sql">NoSQL</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//data-base/mongodb">MongoDB</a><ul><li><a href="/devops-guidebook//data-base/mongodb/overview"><span>基本概述</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/installment"><span>安裝使用</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//data-base/mongodb/basic-usage"><span>基本操作</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/backup-and-recovery"><span>备份与恢复</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/aggregation"><span>聚合管道</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/indexes"><span>数据库索引</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/data-models"><span>数据模型</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/replication"><span>数据库副本集</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/sharding"><span>数据库分片</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/administration"><span>数据库管理</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/security"><span>数据库安全</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/configuration"><span>配置文件</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/command"><span>命令大全</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/mongodb"><span>扩展资料</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/authentication"><span>鉴权</span></a></li><li><a href="/devops-guidebook//data-base/mongodb/shard-key"><span>片键</span></a></li></ul></li><li><a href="/devops-guidebook//data-base/mysql">MySQL</a><ul><li><a href="/devops-guidebook//data-base/mysql/mysql"><span>MySQL</span></a></li><li><a href="/devops-guidebook//data-base/mysql/cluster"><span>集群方案</span></a></li></ul></li><li><a href="/devops-guidebook//data-base/radis">Radis</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="启动数据库" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#启动数据库"><span>启动数据库</span></a></li><li title="连接数据库" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#连接数据库"><span>连接数据库</span></a></li><li title="切换数据库" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#切换数据库"><span>切换数据库</span></a></li><li title="获取帮助信息" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#获取帮助信息"><span>获取帮助信息</span></a></li><li title="删除数据库" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#删除数据库"><span>删除数据库</span></a></li><li title="数据增加" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#数据增加"><span>数据增加</span></a></li><li title="数据修改" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#数据修改"><span>数据修改</span></a></li><li title="update" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#update"><span>update</span></a></li><li title="save" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#save"><span>save</span></a></li><li title="数据查询" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#数据查询"><span>数据查询</span></a></li><li title="条件操作符" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#条件操作符"><span>条件操作符</span></a></li><li title="排序和分页" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#排序和分页"><span>排序和分页</span></a></li><li title="复合条件查询" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#复合条件查询"><span>复合条件查询</span></a></li><li title="包含与全部" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#包含与全部"><span>包含与全部</span></a></li><li title="判断字段是否存在" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#判断字段是否存在"><span>判断字段是否存在</span></a></li><li title="空值处理" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#空值处理"><span>空值处理</span></a></li><li title="取模运算" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#取模运算"><span>取模运算</span></a></li><li title="正则匹配" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#正则匹配"><span>正则匹配</span></a></li><li title="获取查询结果数量" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#获取查询结果数量"><span>获取查询结果数量</span></a></li><li title="distinct" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#distinct"><span>distinct</span></a></li><li title="数据删除" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#数据删除"><span>数据删除</span></a></li><li title="deleteOne 和 deleteMany" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#deleteone-和-deletemany"><span>deleteOne 和 deleteMany</span></a></li><li title="remove" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#remove"><span>remove</span></a></li><li title="索引" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#索引"><span>索引</span></a></li><li title="创建索引" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#创建索引"><span>创建索引</span></a></li><li title="删除索引" data-depth="3"><a href="/devops-guidebook//data-base/mongodb/basic-usage#删除索引"><span>删除索引</span></a></li><li title="导出数据文件" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#导出数据文件"><span>导出数据文件</span></a></li><li title="导入数据文件" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#导入数据文件"><span>导入数据文件</span></a></li><li title="副本集" data-depth="2"><a href="/devops-guidebook//data-base/mongodb/basic-usage#副本集"><span>副本集</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="基本操作"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#基本操作"><span class="icon,icon-link"></span></a>基本操作</h1><ul><li>安装 Install</li><li>创建 Create</li><li>读取 Read</li><li>更新 Update</li><li>删除 Delete</li></ul><h2 id="启动数据库"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#启动数据库"><span class="icon,icon-link"></span></a>启动数据库</h2><p>启动数据库使用 <code>mongod</code> 命令。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 方式一：普通方式启动</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 不实用默认端口的话可以加上 --port=[端口号]参数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongod --dbpath ~/data/db</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 方式二：通过配置文件启动</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongod --config ~/mongo.conf</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>配置文件内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 服务端口</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">27017</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 数据文件路径</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">dbpath</span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 日志文件路径</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">logpath</span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 打开日志输出操作</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">logappend</span><span class="token operator">=</span><span class="token plain">true</span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 不使用任何的验证方式登陆</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token assign-left variable">noauth</span><span class="token operator">=</span><span class="token plain">true</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="连接数据库"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#连接数据库"><span class="icon,icon-link"></span></a>连接数据库</h2><p>连接数据库使用 <code>mongo [, 链接字符串]</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">mongodb</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token plain">username</span><span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token plain">password</span><span class="token operator">&gt;</span><span class="token plain">@</span><span class="token operator">&lt;</span><span class="token plain">host</span><span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token plain">port1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token plain">host2</span><span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token plain">port2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token spread operator">...</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token plain">hostN</span><span class="token operator">&gt;</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token plain">portN</span><span class="token operator">&gt;</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token plain">database</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token operator">&lt;</span><span class="token plain">options</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>登陆本地默认数据库服务器，无用户名密码，端口默认 27017，链接默认的 db 数据库。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 连接数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongo mongodb://localhost/db</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>🌰 <strong>示例：</strong></p><p>或，使用用户名 admin、密码 123456，登陆本地端口为 27017 的 test 数据库。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 实战示例</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongo mongodb://admin:123456@localhost:27017/test</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>以下代码可以帮助我们连接到本地 Docker 容器上运行的 mongod 进程</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> mongoose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> mongoDB </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;mongodb://localhost:27017/demo&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">conncet</span><span class="token punctuation">(</span><span class="token plain">mongoDB</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">useNewUrlParser</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> db</span><span class="token punctuation">.</span><span class="token property-access">mongoose</span><span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;error&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token plain">console</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;MongoDB连接异常&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="切换数据库"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#切换数据库"><span class="icon,icon-link"></span></a>切换数据库</h2><p>切换数据库用 <code>use &lt;db_name&gt;</code>，如果该数据库不存在，则会新建一个数据库。</p><p>🌰 <strong>示例：</strong></p><p>例如创建一个 test 的数据库：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 切换数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">use </span><span class="token operator">&lt;</span><span class="token plain">db_name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看当前所在数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>&lt;db_name&gt;</code> 为数据库名称。</p><p>显示当前所有的数据库可以使用命令 <code>show dbs</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看全部数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">show dbs</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看当前数据库中的集合（类似关系型数据库中的表）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">show collections</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看当前数据的用户信息</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">show </span><span class="token function">users</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查看 <code>db.[集合名称].find()</code> 刚才添加的数据。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token operator">&gt;</span><span class="token plain"> use </span><span class="token builtin class-name">test</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">switched to db </span><span class="token builtin class-name">test</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> db.coll.</span><span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5a66e39914fea5f8ff237420&quot;</span><span class="token punctuation">)</span><span class="token plain">, </span><span class="token string">&quot;title&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;not data!&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>使用 <code>use</code> 命令如果数据库不存在则创建，存在则切换到指定的数据库。</p><h2 id="获取帮助信息"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#获取帮助信息"><span class="icon,icon-link"></span></a>获取帮助信息</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 显示数据库操作命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 显示集合操作命令，同样有很多命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># foo 指当前数据库下，一个叫 foo 的集合，并非真正意义上的命令</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.foo.help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="删除数据库"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#删除数据库"><span class="icon,icon-link"></span></a>删除数据库</h2><p>删除数据库使用 <code>db.dropDataBase()</code> 函数进行。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看所有数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> show dbs</span></div><div class="token-line"><span class="token plain">db    </span><span class="token number">0</span><span class="token plain">.001GB</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">.000GB</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">test</span><span class="token plain">  </span><span class="token number">0</span><span class="token plain">.000GB</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 切换到要删除的数据库 test</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> use </span><span class="token builtin class-name">test</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">switched to db </span><span class="token builtin class-name">test</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除当前数据库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> db.</span><span class="token function-name function">dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;dropped&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;test123&quot;</span><span class="token plain">, </span><span class="token string">&quot;ok&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token comment"># 删除成功</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="数据增加"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#数据增加"><span class="icon,icon-link"></span></a>数据增加</h2><p>数据添加方法：</p><ul><li><code>insert()</code></li><li><code>insertOne()</code></li><li><code>insertMany()</code></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># insert 插入一条数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain">, sex: </span><span class="token string">&quot;male&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># insert 也可以插入多条数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain">, sex: </span><span class="token string">&quot;male&quot;</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Amy&quot;</span><span class="token plain">, sex: </span><span class="token string">&quot;female&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># insertOne 只能插入一条数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain">, sex: </span><span class="token string">&quot;male&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># insertMany 可以插入一条或多条数据，但是必须以列表的形式组织数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain">, sex: </span><span class="token string">&quot;male&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 如果不指定 _id，save 的功能与 insert 一样</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.save</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&quot;Amy&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 如果指定 _id，mongodb 就不为该条记录自动生成 _id 了，只有 save 可以指定 _id，insert、insertOne、insertMany 都不可以</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token plain">, name: </span><span class="token string">&quot;Ben&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="数据修改"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#数据修改"><span class="icon,icon-link"></span></a>数据修改</h2><h3 id="update"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#update"><span class="icon,icon-link"></span></a>update</h3><p>修改方法：<code>update()</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># update 的查询条件，类似于 sql update 语句 where 后面部分</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">update</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># update 的对象和一些更新的操作符等，也可以理解为 sql update 语句 set 后面的部分</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    upsert: </span><span class="token operator">&lt;</span><span class="token plain">boolean</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 可选，这个参数的意思是，如果不存在 update 的记录，是否插入 objNew，true 为插入，默认 false，不插入</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    multi: </span><span class="token operator">&lt;</span><span class="token plain">boolean</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 可选，mongodb 默认是 false，只更新找到的第一条记录，如果这个参数为 true，就把按条件查出来多条记录全部更新</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    writeConcern: </span><span class="token operator">&lt;</span><span class="token plain">document</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token comment"># 可选，抛出异常的级别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>Ben 同学发现老是把她的 C++ 课程分数录错了，需要修改为 75 分：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: ObjectId</span><span class="token punctuation">(</span><span class="token string">&#x27;...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> score: </span><span class="token number">75</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>老师发现把 Ben 同学的名字录错了，需要全部修改过来：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 这样是不对的，只会修改一条记录</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> _id: ObjectId</span><span class="token punctuation">(</span><span class="token string">&#x27;...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> score: </span><span class="token number">75</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 这样才对</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain">, class: </span><span class="token string">&#x27;Java&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> score: </span><span class="token number">95</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> multi: </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>将 Ben 的 Java 课程分数改为 95 分，如果找不到，就插入一条记录：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain">, class: </span><span class="token string">&#x27;Java&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$set</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> score: </span><span class="token number">95</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain">, </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="save"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#save"><span class="icon,icon-link"></span></a>save</h3><p>save 方法通过传入的文档来替换已有文档。语法格式如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.save</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">document</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 文档数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    writeConcern: </span><span class="token operator">&lt;</span><span class="token plain">document</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 可抛，抛出的异常级别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="数据查询"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#数据查询"><span class="icon,icon-link"></span></a>数据查询</h2><p>数据查询的方法有 <code>findOne</code> 和 <code>find</code>，二者参数等用法一致，但是 <code>findOne</code> 只返回一条匹配的数据，<code>find</code> 返回全部的匹配数据。</p><h3 id="条件操作符"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#条件操作符"><span class="icon,icon-link"></span></a>条件操作符</h3><table><thead><tr><th>操作</th><th>SQL 查询写法</th><th>MongoDB 查询写法</th></tr></thead><tbody><tr><td>等于</td><td><code>select * from collection where score = 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: 75<!-- -->}<!-- -->)</code></td></tr><tr><td>小于</td><td><code>select * from collection where score &lt; 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: <!-- -->{<!-- --> $lt: 75<!-- -->}<!-- -->}<!-- -->)</code></td></tr><tr><td>小于等于</td><td><code>select * from collection where score = 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: <!-- -->{<!-- --> $lte: 75<!-- -->}<!-- -->}<!-- -->)</code></td></tr><tr><td>大于</td><td><code>select * from collection where score &gt; 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: <!-- -->{<!-- --> $gt: 75<!-- -->}<!-- -->}<!-- -->)</code></td></tr><tr><td>大于等于</td><td><code>select * from collection where score &gt;= 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: <!-- -->{<!-- --> $gte: 75<!-- -->}<!-- -->}<!-- -->)</code></td></tr><tr><td>不等于</td><td><code>select * from collection where score != 75</code></td><td><code>db.collection.find(<!-- -->{<!-- --> score: <!-- -->{<!-- --> $ne: 75<!-- -->}<!-- -->}<!-- -->)</code></td></tr></tbody></table><h3 id="排序和分页"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#排序和分页"><span class="icon,icon-link"></span></a>排序和分页</h3><p>以分数从高到低显示学生的 C++ 课程成绩，只显示第 10 名到第 20 名的学生：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> class: </span><span class="token string">&#x27;C++&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain">.sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> score: -1 </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain">.skip</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain">.limit</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># sort: 1 为升序, -1 为降序, 默认升序</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># limit: 显示多少条数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># skip: 跳过多少条数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="复合条件查询"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#复合条件查询"><span class="icon,icon-link"></span></a>复合条件查询</h3><p><code>and</code>：<code>find</code> 方法可以传入多个键值对，每个键值对以逗号隔开，即常规 SQL 的 AND 条件。</p><p>查询 Ben 同学的 C++ 课程成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token punctuation">,</span><span class="token plain"> class: </span><span class="token string">&#x27;C++&#x27;</span><span class="token plain"> }</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询分数在 75 到 85 之间的成绩记录：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ socre: { $gt: </span><span class="token number">75</span><span class="token punctuation">,</span><span class="token plain"> $lt: </span><span class="token number">85</span><span class="token plain"> }}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>or</code>：MongoDB OR 条件语句使用了关键字 <code>$or</code>，语法格式如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  {</span></div><div class="token-line"><span class="token plain">    $</span><span class="token operator">or</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      { key1: value1 }</span><span class="token punctuation">,</span><span class="token plain"> { key2: value2 }</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  }</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询 Ben 或 Jack 的课程成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ $</span><span class="token operator">or</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain">{ name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain"> }</span><span class="token punctuation">,</span><span class="token plain"> { name: </span><span class="token string">&#x27;Jack&#x27;</span><span class="token plain"> }</span><span class="token punctuation">]</span><span class="token plain"> }</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>and</code> 和 <code>or</code> 复合查询：</p><p>查询 Ben 的 C++ 或 Python 课程的成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token punctuation">,</span><span class="token plain"> $</span><span class="token operator">or</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token plain">{ class: </span><span class="token string">&#x27;C++&#x27;</span><span class="token plain"> }</span><span class="token punctuation">,</span><span class="token plain"> { class: </span><span class="token string">&#x27;Python&#x27;</span><span class="token plain"> }</span><span class="token punctuation">]</span><span class="token plain">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="包含与全部"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#包含与全部"><span class="icon,icon-link"></span></a>包含与全部</h3><ul><li>包含 <code>in</code></li><li>不包含 <code>nin</code></li><li>全部 <code>all</code></li></ul><p>查询 Ben、Jack 和 Amy 的成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ name: { $</span><span class="token operator">in</span><span class="token plain">: </span><span class="token punctuation">[</span><span class="token string">&#x27;Ben&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Jack&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Amy&#x27;</span><span class="token punctuation">]</span><span class="token plain"> } }</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询除了 Ben、Jack 和 Amy 之外，其他人的成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db</span><span class="token punctuation">.</span><span class="token plain">collection</span><span class="token punctuation">.</span><span class="token plain">find</span><span class="token punctuation">(</span><span class="token plain">{ name: { $nin: </span><span class="token punctuation">[</span><span class="token string">&#x27;Ben&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Jack&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Amy&#x27;</span><span class="token punctuation">]</span><span class="token plain"> }</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>in</code> 和 <code>nin</code> 比较好理解，跟 SQL 的用法类似，<code>all</code> 类似于 <code>in</code>，不同的地方是，<code>in</code> 只需要满足列表中的一个值即可，而 <code>all</code> 需要满足列表中的全部值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 用 all 操作符，表示需要满足 C++ 和 Java 两项</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> course: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$all</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;C++&#x27;</span><span class="token plain">, </span><span class="token string">&#x27;Java&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="判断字段是否存在"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#判断字段是否存在"><span class="icon,icon-link"></span></a>判断字段是否存在</h3><p>需要找出没有 <code>tel</code> 字段的学生：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 字段不存在就用false，存在就用true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;tel&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="空值处理"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#空值处理"><span class="icon,icon-link"></span></a>空值处理</h3><p>如果只想找 <code>tel</code> 值为 <code>null</code> 的情况：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> tel: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">null</span><span class="token punctuation">]</span><span class="token plain">, </span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="取模运算"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#取模运算"><span class="icon,icon-link"></span></a>取模运算</h3><p>比如，查找学生成绩取模 10 等于 0 的数据（即 100、90 、80 等等）</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> tel: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$in</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">null</span><span class="token punctuation">]</span><span class="token plain">, </span><span class="token variable">$exists</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="正则匹配"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#正则匹配"><span class="icon,icon-link"></span></a>正则匹配</h3><p>查询学生名字以 <code>a</code> 开头的学生成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token variable">$regex</span><span class="token builtin class-name">:</span><span class="token plain"> /^a.*/ </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="获取查询结果数量"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#获取查询结果数量"><span class="icon,icon-link"></span></a>获取查询结果数量</h3><p>查询学生名字以 <code>a</code> 开头的学生成绩：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>当使用 <code>limit</code> 方法限制返回的记录数时，默认情况下 <code>count</code> 方法仍然返回全部记录条数。如果希望返回限制之后的记录数量，要使用 <code>count(true)</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain">.limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain">.count</span><span class="token punctuation">(</span><span class="token plain">true</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="distinct"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#distinct"><span class="icon,icon-link"></span></a>distinct</h3><p>查询课程成绩表中所有学生的名单：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.distinct</span><span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="数据删除"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#数据删除"><span class="icon,icon-link"></span></a>数据删除</h2><h3 id="deleteone-和-deletemany"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#deleteone-和-deletemany"><span class="icon,icon-link"></span></a>deleteOne 和 deleteMany</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除 Ben 的一条成绩记录</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除 Ben 的所有成绩记录</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除成绩表里所有内容</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.collection.deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="remove"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#remove"><span class="icon,icon-link"></span></a>remove</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.remove</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">query</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 可选，查询条件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    justOne: </span><span class="token operator">&lt;</span><span class="token plain">boolean</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token comment"># 可选，设置为 true 或者 1，表示只删除一个文档，设置为 false，表示删除所有匹配的文档，默认为 false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    writeConcern: </span><span class="token operator">&lt;</span><span class="token plain">document</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token comment"># 可选，抛出异常的级别</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>删除 Ben 的所有成绩记录：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">db.collection.remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name: </span><span class="token string">&#x27;Ben&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># remove 方法并不会真正释放空间，需要继续执行 db.repairDatabase() 来回收磁盘空间</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.repairDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 与上一句等效，仍以执行一句即可</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.runCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> repairDatabase: </span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>remove</code> 现在已经过时了，官方推荐使用 <code>deleteOne</code> 和 <code>deleteMany</code> 方法。</p><h2 id="索引"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#索引"><span class="icon,icon-link"></span></a>索引</h2><p>索引通常能够极大的提高查询的效率，就像书的目录一样，如果没有索引 mongodb 就会去扫描集合中的每个文件并选取符合查询条件的数据，在数据量大的时候这种查询相率很低下。</p><p>使用 <code>db.集合名称.getIndexed()</code> 获取集合索引。</p><h3 id="创建索引"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#创建索引"><span class="icon,icon-link"></span></a>创建索引</h3><p>创建索引的方法：<code>createIndex()</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 在 person 集合中针对 name 字段创建一个升序排列的索引</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.person.createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.person.getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;v&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;ns&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;test.person&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;v&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;name_1&quot;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;ns&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;test.person&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="删除索引"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#删除索引"><span class="icon,icon-link"></span></a>删除索引</h3><p>删除索引的方法：<code>dropIndex()</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 删除指定索引</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.person.dropIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&quot;nIndexesWas&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">, </span><span class="token string">&quot;ok&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.person.getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;v&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;ns&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&quot;test.person&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 删除全部索引</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.person.dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="导出数据文件"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#导出数据文件"><span class="icon,icon-link"></span></a>导出数据文件</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">mongodump -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 -o 文件存在路径</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>如果没有用户谁，可以去掉 <code>-u</code> 和 <code>-p</code>。</li><li>如果导出本机的数据库，可以去掉 <code>-h</code>。</li><li>如果是默认端口，可以去掉 <code>--port</code>。</li><li>如果想导出所有数据库，可以去掉 <code>-d</code>。</li></ul><h2 id="导入数据文件"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#导入数据文件"><span class="icon,icon-link"></span></a>导入数据文件</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">mongorestore -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 --drop</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>--drop</code> 的意思是，先删除所有的记录，然后恢复</p><h2 id="副本集"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//data-base/mongodb/basic-usage#副本集"><span class="icon,icon-link"></span></a>副本集</h2><p>使用 Docker 创建 MongoDB 副本集</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 创建 Docker Network</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network create mynetwork</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network </span><span class="token function">ls</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>创建需要使用的复制集节点</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 运行三个 Docker 容器，每个容易一个 mongod 节点</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker run --net mynetwork --name mongol -v /mymongo/data1:/data/db -p </span><span class="token number">27017</span><span class="token plain">:27017 -d mongo:4 --replSet myset --port </span><span class="token number">27017</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker run --net mynetwork --name mongo2 -v /mymongo/data2:/data/db -p </span><span class="token number">27018</span><span class="token plain">:27018 -d mongo:4 --replSet myset --port </span><span class="token number">27018</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker run --net mynetwork --name mongo3 -v /mymongo/data3:/data/db -p </span><span class="token number">27019</span><span class="token plain">:27019 -d mongo:4 --replSet myset --port </span><span class="token number">27019</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>创建复制集</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 创建一个拥有三个节点的复制集</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker </span><span class="token builtin class-name">exec</span><span class="token plain"> -it mongo1 mongo</span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&gt;</span><span class="token plain"> rs.initiate</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    _id: </span><span class="token string">&quot;myset&quot;</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">    members: </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    	</span><span class="token comment"># mongo1 是 docker 容器名称，27017 是 docker 暴露宿主机的端口</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">0</span><span class="token plain">, host: </span><span class="token string">&quot;mongo1:27017&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">1</span><span class="token plain">, host: </span><span class="token string">&quot;mongo2:27018&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain">,</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"> _id: </span><span class="token number">2</span><span class="token plain">, host: </span><span class="token string">&quot;mongo3:27019&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查看复制集状态</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ rs.status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><hr/><p><strong>参考资料：</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/weixin_34095889/article/details/89046540">MongoDB 学习笔记纯干货<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/data-base/mongodb/basic-usage.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">1/21/2021, 02:51:50</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__data-base__mongodb__basic-usage.md.js"></script>
  </body>
</html>
